{% extends 'base.html.twig' %}

{% block body %}
    <h1>Liste doc</h1>

    <!-- Ajoutez ce formulaire pour choisir le nombre de documents par page -->
    <form method="POST" action="controleur.php?page=documents&action=read">
        <label for="limit">Documents par page :</label>
        <select id="limit" name="limit">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
        </select>
        <label for="page">Page :</label>
        <input type="number" id="page" name="page" min="1" value="1">
        <input type="submit" value="Appliquer">
    </form>

    <!-- Formulaire de recherche -->
    <input type="text" id="search" placeholder="Rechercher...">

    {% for category_name, documents in documentsByCategory %}
        <input type="checkbox" class="category-checkbox" id="{{ category_name }}" name="{{ category_name }}" checked>
        <label for="{{ category_name }}">Afficher {{ category_name }}</label>
    {% endfor %}

    {% for category_name, documents in documentsByCategory %}
        <div class="category" data-category="{{ category_name }}">
            <h4>Catégorie : {{ category_name }}</h4>
            {% for document in documents %}
                <!-- Ajoutez une classe "document" et un attribut "data-title" à chaque document -->
                <div class="document" data-title="{{ document.titre }}">
                    <p>ID: {{ document.idt_doc }}</p>
                    <p>Titre: {{ document.titre }}</p>
                    <a href="controleur.php?page=documents&action=read&id={{ document.idt_doc }}">Voir</a>
                </div>
            {% endfor %}
        </div>
    {% endfor %}

    <script>
        document.querySelectorAll('.category-checkbox').forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                var category = this.id;
                document.querySelectorAll('.category').forEach(function(categoryDiv) {
                    if (categoryDiv.getAttribute('data-category') === category) {
                        categoryDiv.style.display = checkbox.checked ? 'block' : 'none';
                    }
                });
            });
        });

        // Ajoutez ce code pour la recherche
        document.getElementById('search').addEventListener('input', function() {
            var searchValue = this.value.toLowerCase();
            document.querySelectorAll('.document').forEach(function(documentDiv) {
                var title = documentDiv.getAttribute('data-title').toLowerCase();
                documentDiv.style.display = title.includes(searchValue) ? 'block' : 'none';
            });
        });
    </script>
{% endblock %}