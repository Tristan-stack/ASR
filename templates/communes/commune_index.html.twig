{% extends 'base.html.twig' %}

{% block body %}
    <h1>Liste communes</h1>
    {% if session.role_id == 1 %}
        <a href="controleur.php?page=asr&action=create">Créer une commune</a>
    {% endif %}
    <form method="get">
        <label for="nom">Nom :</label>
        <input type="text" id="nom" name="nom" value="{{ app.request.get('nom') }}">
        <label for="cp">Code Postal :</label>
        <input type="text" id="cp" name="cp" value="{{ app.request.get('cp') }}">
        <label for="order">Trier par :</label>
        <select id="order" name="order">
            <option value="">Aucun</option>
            <option value="asc" {% if app.request.get('order') == 'asc' %}selected{% endif %}>Alphabétique</option>
            <option value="desc" {% if app.request.get('order') == 'desc' %}selected{% endif %}>Inverse alphabétique</option>
        </select>
        <input type="submit" value="Filtrer">
        <button type="submit" name="reset" value="1">Réinitialiser</button>
    </form> 

    <ul id="commune-list" style="list-style: none; padding: 0;">
        {% for item in asr %}
            <li class="commune-item" style="display: none;">Nom : <a href="controleur.php?page=asr&id={{ item.idt_asr }}">{{ item.nom }}</a>, Code Postal : {{ item.cp }}</li>
        {% endfor %}
    </ul>

    <div class="pagination">
        <button id="prev-btn">Précédent</button>
        <span id="page-indicator"></span>
        <button id="next-btn">Suivant</button>
        <label for="page-select">Aller à la page :</label>
        <input type="number" id="page-select" min="1" max="{{ totalPages }}" value="1">
    </div>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- jQuery UI -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <!-- jQuery UI CSS -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">


    <script>
        $(document).ready(function() {
            // Auto-completion
            var communeNames = [
                {% for item in asr %}
                    "{{ item.nom }}",
                {% endfor %}
            ];

            $("#nom").autocomplete({
                source: communeNames
            });

            // Pagination
            const itemsPerPage = 15;
            const items = $(".commune-item");
            const totalPages = Math.ceil(items.length / itemsPerPage);
            let currentPage = 1;

            function showPage(page) {
                const start = (page - 1) * itemsPerPage;
                const end = start + itemsPerPage;

                items.hide();
                items.slice(start, end).show();

                $("#page-indicator").text(`Page ${page} / ${totalPages}`);
                $("#page-select").val(page);
            }

            $("#prev-btn").click(function() {
                if (currentPage > 1) {
                    currentPage--;
                    showPage(currentPage);
                }
            });

            $("#next-btn").click(function() {
                if (currentPage < totalPages) {
                    currentPage++;
                    showPage(currentPage);
                }
            });

            $("#page-select").change(function() {
                const selectedPage = parseInt($(this).val(), 10);
                if (selectedPage >= 1 && selectedPage <= totalPages) {
                    currentPage = selectedPage;
                    showPage(currentPage);
                } else {
                    $(this).val(currentPage);
                }
            });

            showPage(currentPage);
        });
    </script>
{% endblock %}
